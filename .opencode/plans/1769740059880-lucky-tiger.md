# Plan: /studio Conversational Interface with Sidebar

## Overview
Build a read-only monitoring interface at `/studio` with a sidebar showing conversation threads and a main area displaying AI conversations using ai-elements components.

**Requirements Summary:**
- Open access (no authentication required)
- Sidebar displays: customer name, last message preview, platform icon (Instagram, Messenger, WhatsApp)
- Read-only monitoring (view conversations, no sending)
- Data from Convex (threads + messages tables already exist)
- Use ai-elements for conversation UI
- Follow Vercel React best practices and UI/UX guidelines

---

## Phase 1: Data Layer (Convex Queries)

### Files to Create/Modify:

**1. `convex/threads.ts`** - Add thread listing queries
- Add `listByShop` query to fetch all threads for a shop with pagination
- Add `get` query to fetch single thread details
- Use existing indexes: `by_shop_status` for efficient querying

**2. `convex/messages.ts`** - Already exists, verify it supports our needs
- `listByThread` query already exists (paginated by timestamp)
- Ensure it returns role, content, timestamp, toolCalls

**Implementation Notes:**
- Use Convex's reactive queries for real-time updates
- Sort threads by `lastMessageAt` descending (most recent first)
- Limit to 50 threads initially, with pagination support

---

## Phase 2: Route Structure

### Files to Create:

**1. `app/studio/layout.tsx`** - Root layout with sidebar
- Fixed sidebar on left (280px width)
- Main content area on right (flex-1)
- Responsive: sidebar becomes drawer on mobile
- Use shadcn/ui Sidebar component or custom implementation

**2. `app/studio/page.tsx`** - Default view
- Shows "Select a thread" placeholder when no thread selected
- Or redirect to most recent thread

**3. `app/studio/[threadId]/page.tsx`** - Individual thread view
- Displays conversation for specific thread
- Uses ai-elements Conversation/Message components
- URL parameter: `threadId` (Convex thread ID)

---

## Phase 3: Components

### New Components to Create:

**1. `components/studio/thread-sidebar.tsx`**
- Props: `shopId`, `selectedThreadId`, `onSelectThread`
- Fetches threads using `useQuery(api.threads.listByShop)`
- Renders thread list with:
  - Customer name (bold)
  - Last message preview (truncated to 60 chars)
  - Platform icon (Instagram, Messenger, WhatsApp)
  - Timestamp (relative: "2m ago", "1h ago")
  - Unread badge (if unreadCount > 0)
- Active state styling for selected thread
- Scrollable container with sticky header

**2. `components/studio/thread-list-item.tsx`**
- Single thread row component
- Props: `thread`, `isSelected`, `onClick`
- Platform icon mapping:
  - "instagram" → Instagram icon
  - "messenger" → Messenger icon  
  - "whatsapp" → WhatsApp icon
- Hover effects and selection state
- Accessible with proper ARIA labels

**3. `components/studio/conversation-view.tsx`**
- Props: `threadId`
- Fetches messages using `useQuery(api.messages.listByThread)`
- Uses ai-elements components:
  ```tsx
  import { Conversation, ConversationContent } from "@/components/ai-elements/conversation";
  import { Message, MessageContent, MessageResponse } from "@/components/ai-elements/message";
  ```
- Renders messages with role-based styling:
  - User messages: right-aligned, primary color
  - Assistant messages: left-aligned, muted background
- Auto-scroll to bottom on new messages
- Shows tool calls using Tool component from ai-elements
- Read-only (no input field)

**4. `components/studio/platform-icon.tsx`**
- Props: `platform: "instagram" | "messenger" | "whatsapp"`
- Returns appropriate icon component
- Consistent sizing (16x16 or 20x20)

**5. `components/studio/empty-state.tsx`**
- Shown when no thread selected
- Simple illustration or icon
- Text: "Select a conversation to view"

---

## Phase 4: Integration & Best Practices

### AI Elements Integration:
- ai-elements already installed via shadcn CLI
- Import pattern: `from "@/components/ai-elements/[component]"`
- Use Conversation component for auto-scroll behavior
- Use Message component for consistent message styling
- Use Tool component for displaying tool invocations

### Vercel React Best Practices:
- **async-parallel**: Fetch threads and messages in parallel where possible
- **bundle-dynamic-imports**: Lazy load conversation view component
- **rerender-memo**: Memoize thread list items to prevent unnecessary re-renders
- **client-swr-dedup**: Convex's useQuery handles deduplication automatically
- **rendering-hoist-jsx**: Extract static JSX (icons, empty states) outside components

### UI/UX Best Practices:
- **Touch targets**: Minimum 44x44px for clickable thread items
- **Color contrast**: Ensure text meets 4.5:1 ratio
- **Loading states**: Skeleton screens for thread list and messages
- **Focus states**: Visible focus rings on interactive elements
- **Responsive**: Sidebar collapses to drawer on mobile (< 768px)
- **Accessibility**: ARIA labels, keyboard navigation, screen reader support

### Design System:
- Use existing shadcn/ui components (Card, Badge, Button, ScrollArea)
- Match existing color scheme from `app/globals.css`
- Thread sidebar: `bg-muted` background, border-right separator
- Selected thread: `bg-accent` or `bg-primary/10`
- Platform icons: Use consistent color (e.g., blue for Messenger, pink for Instagram, green for WhatsApp)

---

## Phase 5: Implementation Order

1. **Setup data layer** (convex queries)
   - Add listByShop and get queries to threads.ts
   - Test queries in Convex dashboard

2. **Create layout** (app/studio/layout.tsx)
   - Implement sidebar + main content structure
   - Add responsive behavior

3. **Build sidebar** (thread-sidebar.tsx, thread-list-item.tsx)
   - Thread list with platform icons
   - Selection state management
   - Loading skeletons

4. **Build conversation view** (conversation-view.tsx)
   - Integrate ai-elements components
   - Message rendering with proper styling
   - Auto-scroll behavior

5. **Connect everything** (page.tsx, [threadId]/page.tsx)
   - Route handling
   - State synchronization
   - Empty states

6. **Polish & test**
   - Responsive testing
   - Accessibility audit
   - Performance optimization

---

## Critical Files to Modify

| File | Change Type | Description |
|------|-------------|-------------|
| `convex/threads.ts` | Modify | Add listByShop and get queries |
| `app/studio/layout.tsx` | Create | Root layout with sidebar |
| `app/studio/page.tsx` | Create | Default/empty state view |
| `app/studio/[threadId]/page.tsx` | Create | Thread conversation view |
| `components/studio/thread-sidebar.tsx` | Create | Sidebar with thread list |
| `components/studio/thread-list-item.tsx` | Create | Individual thread row |
| `components/studio/conversation-view.tsx` | Create | Messages display |
| `components/studio/platform-icon.tsx` | Create | Platform icon mapping |

---

## Verification Steps

1. **Navigation**: 
   - Visit `/studio` → should show empty state or first thread
   - Visit `/studio/[threadId]` → should show specific conversation
   - Click thread in sidebar → URL updates, conversation changes

2. **Data Loading**:
   - Threads load in sidebar with customer names
   - Last message preview shows correctly
   - Platform icons display (IG, Messenger, WhatsApp)
   - Messages load for selected thread

3. **Real-time Updates**:
   - New message arrives → appears in conversation automatically
   - Thread list updates when new message comes in

4. **Responsive**:
   - Desktop: Sidebar fixed on left, conversation on right
   - Mobile (< 768px): Sidebar becomes hamburger menu or drawer

5. **Accessibility**:
   - Tab navigation works through thread list
   - Screen reader announces thread selection
   - Color contrast meets WCAG AA standards

---

## Dependencies

**Already Installed:**
- Next.js 16, React 19, TypeScript 5
- Tailwind CSS 4, shadcn/ui
- Convex (backend)
- ai-elements (via shadcn CLI)
- @ai-sdk/react (already in use)

**Icons Needed:**
- Instagram icon (lucide-react or custom)
- Messenger icon (lucide-react or custom)
- WhatsApp icon (lucide-react or custom)

**shadcn/ui Components to Use:**
- ScrollArea (for scrollable lists)
- Badge (for unread counts)
- Skeleton (for loading states)
- Separator (for dividers)

---

## Notes

- **Read-only**: No input field or send functionality (as requested)
- **Open access**: No auth middleware needed (as requested)
- **Performance**: Use React.memo for thread list items to prevent re-renders when conversation updates
- **Type safety**: Ensure all Convex IDs are properly typed with `Id<"threads">` and `Id<"messages">`
